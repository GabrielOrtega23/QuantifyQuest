<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantifiers Quest - Learn English Quantifiers</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .scoreboard {
        background: rgba(0, 0, 0, 0.7);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.5s ease-out;
    }
    
    .scoreboard-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 30px;
        border-radius: 15px;
        width: 80%;
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        text-align: center;
        color: white;
    }
    
    .scoreboard-title {
        font-size: 2rem;
        margin-bottom: 20px;
        color: #feca57;
    }
    
    .scoreboard-results {
        margin-bottom: 30px;
    }
    
    .scoreboard-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
    }
    
    .scoreboard-label {
        font-weight: 500;
    }
    
    .scoreboard-value {
        font-weight: bold;
    }
    
    .scoreboard-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .game-title {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease-in-out infinite;
            margin-bottom: 10px;
        }

        .game-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .tab-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        .auth-form {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .game-area {
            text-align: center;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 500;
        }

        .question-container {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideInUp 0.6s ease-out;
        }

        .question-number {
            font-size: 1rem;
            color: #666;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-btn {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .option-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
        }

        .option-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .option-btn.correct {
            border-color: #10ac84;
            background: #10ac84;
            color: white;
        }

        .option-btn.incorrect {
            border-color: #ee5a52;
            background: #ee5a52;
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #10ac84, #1dd1a1);
            transition: width 0.5s ease;
        }

        .explanation {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
            display: none;
        }

        .explanation.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .explanation h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .guide-section {
            margin-bottom: 30px;
        }

        .guide-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #feca57;
        }

        .quantifier-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #feca57;
        }

        .quantifier-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #feca57;
        }

        .quantifier-usage {
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .quantifier-examples {
            font-style: italic;
            opacity: 0.8;
        }

        .multiplayer-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            align-items: start;
        }

        .players-list {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .player-item.current-user {
            background: rgba(255, 206, 87, 0.3);
            border: 1px solid #feca57;
        }

        .room-controls {
            margin-bottom: 20px;
        }

        .room-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .room-input input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .connection-status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 500;
        }

        .status-connected {
            background: rgba(16, 172, 132, 0.3);
            color: #10ac84;
            border: 1px solid #10ac84;
        }

        .status-disconnected {
            background: rgba(238, 90, 82, 0.3);
            color: #ee5a52;
            border: 1px solid #ee5a52;
        }

        .status-connecting {
            background: rgba(255, 206, 87, 0.3);
            color: #feca57;
            border: 1px solid #feca57;
        }

        .results-container {
            text-align: center;
            padding: 40px;
        }

        .final-score {
            font-size: 3rem;
            font-weight: bold;
            color: #feca57;
            margin-bottom: 20px;
        }

        .score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .score-value {
            font-size: 2rem;
            font-weight: bold;
            color: #48dbfb;
        }

        .score-label {
            opacity: 0.8;
            margin-top: 5px;
        }

        .leaderboard {
            margin-top: 30px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .leaderboard-rank {
            font-weight: bold;
            color: #feca57;
            width: 30px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideInRight 0.5s ease-out;
        }

        .notification.success {
            background: #10ac84;
        }

        .notification.error {
            background: #ee5a52;
        }

        .notification.info {
            background: #667eea;
        }

        .timer-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .timer-bar {
            height: 100%;
            background: linear-gradient(45deg, #feca57, #ff6b6b);
            width: 100%;
            transition: width 1s linear;
        }

        .host-controls {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .waiting-message {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(300px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .game-title {
                font-size: 2rem;
            }

            .multiplayer-container {
                grid-template-columns: 1fr;
            }

            .user-stats {
                justify-content: center;
            }

            .options-container {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .score-details {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="game-header">
            <h1 class="game-title">Quantifiers Quest</h1>
            <p class="game-subtitle">Master English Quantifiers Through Interactive Learning</p>
        </header>

        <div class="tab-container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="auth">Login</button>
                <button class="tab-btn" data-tab="solo">Solo Game</button>
                <button class="tab-btn" data-tab="multiplayer">Multiplayer</button>
                <button class="tab-btn" data-tab="guide">Guide</button>
                <button class="tab-btn" data-tab="leaderboard">Leaderboard</button>
            </div>

            <!-- Authentication Tab -->
            <div class="tab-content active" id="auth">
                <div class="auth-container">
                    <div class="auth-form" id="loginForm">
                        <h3>Login to Your Account</h3>
                        <div class="form-group">
                            <label for="loginUsername">Username:</label>
                            <input type="text" id="loginUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password:</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button class="btn" onclick="login()">Login</button>
                        <button class="btn btn-secondary" onclick="showRegister()">Create Account</button>
                    </div>

                    <div class="auth-form" id="registerForm" style="display: none;">
                        <h3>Create New Account</h3>
                        <div class="form-group">
                            <label for="registerUsername">Username:</label>
                            <input type="text" id="registerUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">Email:</label>
                            <input type="email" id="registerEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">Password:</label>
                            <input type="password" id="registerPassword" required>
                        </div>
                        <button class="btn" onclick="register()">Create Account</button>
                        <button class="btn btn-secondary" onclick="showLogin()">Back to Login</button>
                    </div>
                </div>
            </div>

            <!-- Solo Game Tab -->
            <div class="tab-content" id="solo">
                <div class="game-area">
                    <div class="user-info">
                        <div>
                            <span>Welcome, <strong id="currentUser">Player</strong>!</span>
                        </div>
                        <div class="user-stats">
                            <div class="stat-item">Score: <span id="currentScore">0</span></div>
                            <div class="stat-item">Streak: <span id="currentStreak">0</span></div>
                            <div class="stat-item">Best: <span id="bestScore">0</span></div>
                        </div>
                        <button class="btn" onclick="logout()">Logout</button>
                    </div>

                    <div id="gameContainer">
                        <button class="btn" onclick="startSoloGame()" id="startGameBtn">Start Game</button>
                        
                        <div id="questionArea" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressBar"></div>
                            </div>
                            
                            <div class="question-container">
                                <div class="question-number" id="questionNumber">Question 1 of 10</div>
                                <div class="question-text" id="questionText">Loading question...</div>
                                <div class="options-container" id="optionsContainer"></div>
                                <button class="btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">Next Question</button>
                                <div class="explanation" id="explanation">
                                    <h4>Explanation:</h4>
                                    <p id="explanationText"></p>
                                </div>
                            </div>
                        </div>

                        <div id="resultsArea" style="display: none;">
                            <div class="results-container">
                                <div class="final-score" id="finalScore">0/10</div>
                                <div class="score-details">
                                    <div class="score-item">
                                        <div class="score-value" id="correctAnswers">0</div>
                                        <div class="score-label">Correct Answers</div>
                                    </div>
                                    <div class="score-item">
                                        <div class="score-value" id="accuracy">0%</div>
                                        <div class="score-label">Accuracy</div>
                                    </div>
                                    <div class="score-item">
                                        <div class="score-value" id="timeSpent">0s</div>
                                        <div class="score-label">Time Spent</div>
                                    </div>
                                </div>
                                <button class="btn" onclick="startSoloGame()">Play Again</button>
                                <button class="btn btn-secondary" onclick="showTab('leaderboard')">View Leaderboard</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multiplayer Tab -->
        
            <div class="tab-content" id="multiplayer">
                <div class="multiplayer-container">
                    <div class="game-area">
                        <div class="connection-status" id="connectionStatus" class="status-disconnected">
                            Disconnected from server
                        </div>
                        
                        <div class="room-controls">
                            <div class="room-input">
                                <input type="text" id="roomCode" placeholder="Enter room code...">
                                <button class="btn" onclick="joinRoom()">Join Room</button>
                            </div>
                            <button class="btn btn-secondary" onclick="createRoom()">Create New Room</button>
                        </div>

                        <div id="multiplayerGame" style="display: none;">
                            <div id="hostControls" class="host-controls" style="display: none;">
                                <h3>Controles do Host</h3>
                                <button class="btn" onclick="startMultiplayerGame()">Iniciar Jogo</button>
                                <p>Espere todos os jogadores entrarem antes de come√ßar</p>
                            </div>
                        </div>
                            <div id="multiplayerQuestionArea">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="multiplayerProgressBar"></div>
                                </div>
                                
                                <div class="question-container">
                                    <div class="question-number" id="multiplayerQuestionNumber">Waiting for game...</div>
                                    <div class="question-text" id="multiplayerQuestionText">Waiting for other players...</div>
                                    <div class="timer-container">
                                        <div class="timer-bar" id="timerBar"></div>
                                    </div>
                                    <div class="options-container" id="multiplayerOptionsContainer"></div>
                                    <div class="explanation" id="multiplayerExplanation">
                                        <h4>Explanation:</h4>
                                        <p id="multiplayerExplanationText"></p>
                                    </div>
                                </div>
                            </div>

                            <div id="waitingArea" class="waiting-message" style="display: none;">
                                <p>Waiting for host to start the game...</p>
                            </div>

                            <div id="hostControls" class="host-controls" style="display: none;">
                                <p>You are the host. Start the game when all players are ready.</p>
                                <button class="btn" onclick="startMultiplayerGame()">Start Game</button>
                                <button class="btn btn-secondary" onclick="endMultiplayerGame()">End Game</button>
                            </div>
                        </div>
                    </div>

                    <div class="players-list">
                        <h3>Room: <span id="currentRoom">-</span></h3>
                        <div id="playersList">
                            <p>No players connected</p>
                        </div>
                        <button class="btn" onclick="leaveRoom()" id="leaveRoomBtn" style="display: none;">Leave Room</button>
                    </div>
                </div>
            </div>

            <!-- Guide Tab -->
            <div class="tab-content" id="guide">
                <div class="guide-section">
                    <h2 class="guide-title">English Quantifiers Guide</h2>
                    
                    <div class="quantifier-item">
                        <div class="quantifier-name">Some / Any</div>
                        <div class="quantifier-usage"><strong>Some:</strong> Use in positive statements and offers/requests<br><strong>Any:</strong> Use in negative statements and questions</div>
                        <div class="quantifier-examples">Examples: "I have some books" / "Do you have any books?" / "I don't have any books"</div>
                    </div>

                    <div class="quantifier-item">
                        <div class="quantifier-name">Much / Many</div>
                        <div class="quantifier-usage"><strong>Much:</strong> Use with uncountable nouns<br><strong>Many:</strong> Use with countable nouns</div>
                        <div class="quantifier-examples">Examples: "How much water?" / "How many books?"</div>
                    </div>

                    <div class="quantifier-item">
                        <div class="quantifier-name">A few / Few</div>
                        <div class="quantifier-usage"><strong>A few:</strong> Some, positive meaning<br><strong>Few:</strong> Not many, negative meaning</div>
                        <div class="quantifier-examples">Examples: "I have a few friends" (some friends) / "I have few friends" (not many friends)</div>
                    </div>

                    <div class="quantifier-item">
                        <div class="quantifier-name">A little / Little</div>
                        <div class="quantifier-usage"><strong>A little:</strong> Some, positive meaning<br><strong>Little:</strong> Not much, negative meaning</div>
                        <div class="quantifier-examples">Examples: "I have a little money" (some money) / "I have little money" (not much money)</div>
                    </div>

                    <div class="quantifier-item">
                        <div class="quantifier-name">All / Every / Each</div>
                        <div class="quantifier-usage"><strong>All:</strong> The complete amount<br><strong>Every:</strong> All members of a group<br><strong>Each:</strong> Individual members</div>
                        <div class="quantifier-examples">Examples: "All students passed" / "Every student has a book" / "Each student received a certificate"</div>
                    </div>

                    <div class="quantifier-item">
                        <div class="quantifier-name">Most / Several / Enough</div>
                        <div class="quantifier-usage"><strong>Most:</strong> The majority<br><strong>Several:</strong> More than two but not many<br><strong>Enough:</strong> Sufficient amount</div>
                        <div class="quantifier-examples">Examples: "Most people agree" / "Several students came" / "I have enough time"</div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Tab -->
            <div class="tab-content" id="leaderboard">
                <div class="leaderboard">
                    <h2 class="guide-title">Top Players</h2>
                    <div id="leaderboardList">
                        <div class="leaderboard-item">
                            <span><span class="leaderboard-rank">1.</span> Loading...</span>
                            <span>-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
let currentUser = null;
let gameState = {
    currentQuestion: 0,
    score: 0,
    streak: 0,
    questions: [],
    startTime: null,
    answered: false
};

// Multiplayer State
let currentRoom = null;
let isHost = false;
let timerInterval = null;
let socket = null;
let multiplayerGameState = {
    questions: [],
    currentQuestion: 0,
    score: 0
};

// Users Database (simulated backend)
let usersDB = JSON.parse(localStorage.getItem('quantifiersGameUsers') || '{}');
let scoresDB = JSON.parse(localStorage.getItem('quantifiersGameScores') || '[]');

// Initialize WebSocket connection for multiplayer
function initializeWebSocket() {
    try {
        // Determine the correct WebSocket URL based on environment
        const isLocalhost = window.location.hostname === 'localhost' || 
                          window.location.hostname === '127.0.0.1';
        
        const wsProtocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
        const wsHost = isLocalhost ? 'localhost:3000' : window.location.host;
        const wsUrl = `${wsProtocol}${wsHost}`;
        
        console.log(`Connecting to WebSocket at: ${wsUrl}`);
        
        socket = new WebSocket(wsUrl);
        updateConnectionStatus('connecting');

        socket.onopen = () => {
            console.log('WebSocket connection established');
            updateConnectionStatus('connected');
            if (currentUser) {
                const lastRoom = localStorage.getItem('lastRoom');
                if (lastRoom) {
                    joinRoom(lastRoom);
                }
            }
        };

        socket.onclose = () => {
            console.log('WebSocket connection closed');
            updateConnectionStatus('disconnected');
            // Try to reconnect after 5 seconds
            setTimeout(initializeWebSocket, 5000);
        };

        socket.onerror = (error) => {
            console.error('WebSocket error:', error);
            updateConnectionStatus('disconnected');
        };

        socket.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                console.log('Received message:', data);
                handleWebSocketMessage(data);
            } catch (error) {
                console.error('Error parsing WebSocket message:', error);
            }
        };

    } catch (error) {
        console.error('WebSocket connection failed:', error);
        updateConnectionStatus('disconnected');
        // Try again after 5 seconds
        setTimeout(initializeWebSocket, 5000);
    }
}

// Update connection status
function updateConnectionStatus(status) {
    const statusEl = document.getElementById('connectionStatus');
    statusEl.className = 'connection-status';
    
    switch(status) {
        case 'connected':
            statusEl.classList.add('status-connected');
            statusEl.textContent = 'Connected to server';
            break;
        case 'connecting':
            statusEl.classList.add('status-connecting');
            statusEl.textContent = 'Connecting...';
            break;
        case 'disconnected':
            statusEl.classList.add('status-disconnected');
            statusEl.textContent = 'Disconnected from server';
            break;
    }
}

// Tab Management
function showTab(tabName) {
    // Only 'solo' and 'multiplayer' tabs require login
    if ((tabName === 'solo' || tabName === 'multiplayer' || tabName === 'leaderboard') && !currentUser) {
        showNotification('Please login first!', 'error');
        showTab('auth');
        return;
    }
    
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(tabName).classList.add('active');
    
    // Activate corresponding tab button
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    
    // Initialize WebSocket when switching to multiplayer
    if (tabName === 'multiplayer' && !socket) {
        initializeWebSocket();
    }
    
    // Load leaderboard when switching to leaderboard tab
    if (tabName === 'leaderboard') {
        loadLeaderboard();
    }
}

// Authentication Functions
function showLogin() {
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('registerForm').style.display = 'none';
}

function showRegister() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('registerForm').style.display = 'block';
}

function register() {
    const username = document.getElementById('registerUsername').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value;

    if (!username || !email || !password) {
        showNotification('Please fill all fields!', 'error');
        return;
    }

    if (usersDB[username]) {
        showNotification('Username already exists!', 'error');
        return;
    }

    // Create new user
    usersDB[username] = {
        username,
        email,
        password: btoa(password), // Simple encoding (not secure for production)
        bestScore: 0,
        totalGames: 0,
        createdAt: new Date().toISOString()
    };

    // Save to localStorage
    localStorage.setItem('quantifiersGameUsers', JSON.stringify(usersDB));
    
    showNotification('Account created successfully!', 'success');
    showLogin();
}

function login() {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;

    if (!username || !password) {
        showNotification('Please fill all fields!', 'error');
        return;
    }

    const user = usersDB[username];
    if (!user || atob(user.password) !== password) {
        showNotification('Invalid username or password!', 'error');
        return;
    }

    // Set current user
    currentUser = user;
    document.getElementById('currentUser').textContent = username;
    document.getElementById('bestScore').textContent = user.bestScore;
    
    // Save last user
    localStorage.setItem('quantifiersGameLastUser', username);
    
    showNotification('Logged in successfully!', 'success');
    showTab('solo');
}

function logout() {
    currentUser = null;
    document.getElementById('currentUser').textContent = 'Player';
    document.getElementById('currentScore').textContent = '0';
    document.getElementById('currentStreak').textContent = '0';
    document.getElementById('bestScore').textContent = '0';
    
    // Reset forms
    document.getElementById('loginUsername').value = '';
    document.getElementById('loginPassword').value = '';
    
    // Remove last user
    localStorage.removeItem('quantifiersGameLastUser');
    
    showTab('auth');
    showNotification('Logged out successfully!', 'info');
}

// Game Functions
function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

function startSoloGame() {
    if (!currentUser) {
        showNotification('Please login first!', 'error');
        return;
    }

    // Select 10 random different questions each game
    gameState = {
        currentQuestion: 0,
        score: 0,
        streak: 0,
        questions: shuffleArray([...questionsDB]).slice(0, 10),
        startTime: Date.now(),
        answered: false
    };

    document.getElementById('startGameBtn').style.display = 'none';
    document.getElementById('questionArea').style.display = 'block';
    document.getElementById('resultsArea').style.display = 'none';
    
    showQuestion();
}

function showQuestion() {
    const question = gameState.questions[gameState.currentQuestion];
    const progress = ((gameState.currentQuestion) / gameState.questions.length) * 100;
    
    document.getElementById('progressBar').style.width = progress + '%';
    document.getElementById('questionNumber').textContent = 
        `Question ${gameState.currentQuestion + 1} of ${gameState.questions.length}`;
    document.getElementById('questionText').textContent = question.question;
    document.getElementById('currentScore').textContent = gameState.score;
    document.getElementById('currentStreak').textContent = gameState.streak;
    
    // Create option buttons
    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';
    
    question.options.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = option;
        btn.onclick = () => selectAnswer(index);
        optionsContainer.appendChild(btn);
    });

    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('explanation').classList.remove('show');
    gameState.answered = false;
}

function selectAnswer(selectedIndex) {
    if (gameState.answered) return;
    
    gameState.answered = true;
    const question = gameState.questions[gameState.currentQuestion];
    const isCorrect = selectedIndex === question.correct;
    
    // Update score
    if (isCorrect) {
        gameState.score++;
        gameState.streak++;
    } else {
        gameState.streak = 0;
    }
    
    // Update UI
    const options = document.querySelectorAll('.option-btn');
    options[selectedIndex].classList.add(isCorrect ? 'correct' : 'incorrect');
    
    if (!isCorrect) {
        options[question.correct].classList.add('correct');
    }
    
    // Show explanation
    document.getElementById('explanationText').innerHTML = 
        `<strong>Correct answer:</strong> ${question.options[question.correct]}<br><br>
         <strong>Explanation:</strong> ${question.explanation}<br><br>
         <strong>Translation:</strong> ${question.translation}`;
    document.getElementById('explanation').classList.add('show');
    document.getElementById('nextBtn').style.display = 'block';
    
    // Update current score display
    document.getElementById('currentScore').textContent = gameState.score;
    document.getElementById('currentStreak').textContent = gameState.streak;
}

function nextQuestion() {
    gameState.currentQuestion++;
    
    if (gameState.currentQuestion >= gameState.questions.length) {
        endGame();
    } else {
        showQuestion();
    }
}

function endGame() {
    const timeSpent = Math.round((Date.now() - gameState.startTime) / 1000);
    const accuracy = Math.round((gameState.score / gameState.questions.length) * 100);
    
    // Update user's best score
    if (gameState.score > currentUser.bestScore) {
        currentUser.bestScore = gameState.score;
        usersDB[currentUser.username] = currentUser;
        localStorage.setItem('quantifiersGameUsers', JSON.stringify(usersDB));
    }
    
    // Save score to leaderboard
    const scoreEntry = {
        username: currentUser.username,
        score: gameState.score,
        accuracy: Math.round((gameState.score / gameState.questions.length) * 100),
        timeSpent: timeSpent,
        date: new Date().toISOString()
    };
    
    scoresDB.push(scoreEntry);
    scoresDB.sort((a, b) => b.score - a.score);
    scoresDB = scoresDB.slice(0, 100); // Keep top 100 scores
    localStorage.setItem('quantifiersGameScores', JSON.stringify(scoresDB));
    
    // Update user stats
    currentUser.totalGames++;
    document.getElementById('bestScore').textContent = currentUser.bestScore;
    
    // Show results
    document.getElementById('questionArea').style.display = 'none';
    document.getElementById('resultsArea').style.display = 'block';
    
    document.getElementById('finalScore').textContent = `${gameState.score}/${gameState.questions.length}`;
    document.getElementById('correctAnswers').textContent = gameState.score;
    document.getElementById('accuracy').textContent = accuracy + '%';
    document.getElementById('timeSpent').textContent = timeSpent + 's';
    showFinalScoreboard(gameState.score, gameState.questions.length, timeSpent);
}

// Multiplayer Functions
function createRoom() {
    if (!currentUser) {
        showNotification('Please login first!', 'error');
        return;
    }
    
    if (!socket || socket.readyState !== WebSocket.OPEN) {
        showNotification('Not connected to server! Trying to reconnect...', 'error');
        initializeWebSocket();
        return;
    }
    
    const roomCode = Math.random().toString(36).substring(2, 6).toUpperCase();
    
    // Show message while waiting for server response
    showNotification('Creating room...', 'info');
    
    socket.send(JSON.stringify({
        type: 'create_room',
        roomCode: roomCode,
        username: currentUser.username
    }));
}

function joinRoom(roomCode = null) {
    if (!currentUser) {
        showNotification('Please login first!', 'error');
        return;
    }
    
    if (!roomCode) {
        roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
    }
    
    if (!roomCode || roomCode.length !== 4) {
        showNotification('Please enter a valid 4-character room code!', 'error');
        return;
    }
    
    if (!socket || socket.readyState !== WebSocket.OPEN) {
        showNotification('Not connected to server! Trying to reconnect...', 'error');
        initializeWebSocket();
        return;
    }
    
    showNotification(`Joining room ${roomCode}...`, 'info');
    
    socket.send(JSON.stringify({
        type: 'join_room',
        roomCode: roomCode,
        username: currentUser.username
    }));
}

function leaveRoom() {
    if (!socket || socket.readyState !== WebSocket.OPEN) return;
    
    socket.send(JSON.stringify({
        type: 'leave_room',
        roomCode: currentRoom,
        username: currentUser.username
    }));
    
    resetMultiplayerGame();
}

function resetMultiplayerGame() {
    currentRoom = null;
    isHost = false;
    document.getElementById('currentRoom').textContent = '-';
    document.getElementById('playersList').innerHTML = '<p>No players connected</p>';
    document.getElementById('leaveRoomBtn').style.display = 'none';
    document.getElementById('multiplayerGame').style.display = 'none';
    document.getElementById('hostControls').style.display = 'none';
    document.getElementById('waitingArea').style.display = 'none';
    document.getElementById('multiplayerQuestionArea').style.display = 'none';
    document.getElementById('multiplayerResults').style.display = 'none';

    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }

    localStorage.removeItem('lastRoom');
}

function updatePlayersList(players) {
    const playersListEl = document.getElementById('playersList');

    if (!players || players.length === 0) {
        playersListEl.innerHTML = '<p>No players connected</p>';
        return;
    }

    playersListEl.innerHTML = players.map(player => 
        `<div class="player-item ${player.username === currentUser.username ? 'current-user' : ''}">
            <span>${player.username}</span>
            <span>${player.score || 0} pts</span>
        </div>`
    ).join('');
}

function startMultiplayerGame() {
    if (!isHost) return;

    socket.send(JSON.stringify({
        type: 'start_game',
        roomCode: currentRoom
    }));
}

function showMultiplayerQuestion(question, questionIndex) {
    const progress = ((questionIndex) / 10) * 100;

    document.getElementById('multiplayerProgressBar').style.width = progress + '%';
    document.getElementById('multiplayerQuestionNumber').textContent = 
        `Question ${questionIndex + 1} of 10`;
    document.getElementById('multiplayerQuestionText').textContent = question.question;

    const optionsContainer = document.getElementById('multiplayerOptionsContainer');
    optionsContainer.innerHTML = '';

    question.options.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = option;
        btn.onclick = () => selectMultiplayerAnswer(index);
        optionsContainer.appendChild(btn);
    });

    document.getElementById('multiplayerExplanation').classList.remove('show');
    multiplayerGameState.answered = false;
    
    // Start timer
    timeLeft = 15;
    updateTimer(timeLeft);
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timeLeft--;
        updateTimer(timeLeft);
        
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            if (!multiplayerGameState.answered) {
                selectMultiplayerAnswer(-1); // No answer selected
            }
        }
    }, 1000);
}

function updateTimer(timeLeft) {
    const percentage = (timeLeft / 15) * 100;
    document.getElementById('timerBar').style.width = `${percentage}%`;
}

function selectMultiplayerAnswer(selectedIndex) {
    if (multiplayerGameState.answered || !socket || socket.readyState !== WebSocket.OPEN) return;
    
    multiplayerGameState.answered = true;
    const question = multiplayerGameState.questions[multiplayerGameState.currentQuestion];
    const isCorrect = selectedIndex === question.correct;
    
    // Send answer to server
    socket.send(JSON.stringify({
        type: 'submit_answer',
        roomCode: currentRoom,
        username: currentUser.username,
        questionIndex: multiplayerGameState.currentQuestion,
        answerIndex: selectedIndex,
        isCorrect: isCorrect,
        timestamp: Date.now()
    }));
    
    // Update UI
    const options = document.querySelectorAll('#multiplayerOptionsContainer .option-btn');
    
    if (selectedIndex >= 0) {
        options[selectedIndex].classList.add(isCorrect ? 'correct' : 'incorrect');
        
        if (!isCorrect) {
            options[question.correct].classList.add('correct');
        }
    } else {
        // Time ran out - just show correct answer
        options[question.correct].classList.add('correct');
    }
    
    // Show explanation
    document.getElementById('multiplayerExplanationText').innerHTML = 
        `<strong>Correct answer:</strong> ${question.options[question.correct]}<br><br>
         <strong>Explanation:</strong> ${question.explanation}<br><br>
         <strong>Translation:</strong> ${question.translation}`;
    document.getElementById('multiplayerExplanation').classList.add('show');
    
    // Clear timer
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
}

function showAnswerResult(data) {
    if (data.username === currentUser.username) {
        multiplayerGameState.score = data.score;
    }
    
    // Update player list with new scores
    updatePlayersList(data.players);
}

function showMultiplayerResults(results) {
    document.getElementById('multiplayerQuestionArea').style.display = 'none';
    document.getElementById('multiplayerResults').style.display = 'block';
    
    results.sort((a, b) => b.score - a.score);
    
    const resultsList = document.getElementById('multiplayerResultsList');
    resultsList.innerHTML = results.map((result, index) => 
        `<div class="leaderboard-item ${result.username === currentUser.username ? 'current-user' : ''}">
            <span><span class="leaderboard-rank">${index + 1}.</span> ${result.username}</span>
            <span>${result.score}/10</span>
        </div>`
    ).join('');
    
    // Find current user's position
    const userPosition = results.findIndex(r => r.username === currentUser.username) + 1;
    const userScore = results.find(r => r.username === currentUser.username)?.score || 0;
    
    showNotification(`You finished in position ${userPosition} with ${userScore}/10 correct answers!`, 'info');
}

// Handle WebSocket messages
function handleWebSocketMessage(data) {
    if (!data || !data.type) {
        console.error('Invalid message format:', data);
        return;
    }

    console.log('Handling message type:', data.type);
    
    switch(data.type) {
        case 'room_created':
            handleRoomCreated(data);
            break;
            
        case 'room_joined':
            handleRoomJoined(data);
            break;
            
        case 'player_joined':
            updatePlayersList(data.players);
            showNotification(`${data.username} joined the room`, 'info');
            break;
            
        case 'player_left':
            updatePlayersList(data.players);
            showNotification(`${data.username} left the room`, 'info');
            break;
            
        case 'game_started':
            handleGameStarted(data);
            break;
            
        case 'question_update':
            handleQuestionUpdate(data);
            break;
            
        case 'answer_result':
            handleAnswerResult(data);
            break;
            
        case 'game_ended':
            handleGameEnded(data);
            break;
            
        case 'timer_update':
            updateTimer(data.timeLeft);
            break;
            
        case 'error':
            showNotification(data.message, 'error');
            break;
            
        default:
            console.warn('Unknown message type:', data.type);
    }
}

// Helper functions for handleWebSocketMessage
function handleRoomCreated(data) {
    currentRoom = data.roomCode;
    isHost = true;
    
    document.getElementById('currentRoom').textContent = data.roomCode;
    document.getElementById('hostControls').style.display = 'block';
    document.getElementById('waitingArea').style.display = 'none';
    document.getElementById('multiplayerGame').style.display = 'block';
    document.getElementById('leaveRoomBtn').style.display = 'block';
    
    updatePlayersList(data.players);
    showNotification(`Room ${data.roomCode} created successfully!`, 'success');
    localStorage.setItem('lastRoom', data.roomCode);
}

function handleRoomJoined(data) {
    currentRoom = data.roomCode;
    isHost = false;
    
    document.getElementById('currentRoom').textContent = data.roomCode;
    document.getElementById('hostControls').style.display = 'none';
    document.getElementById('waitingArea').style.display = 'block';
    document.getElementById('multiplayerGame').style.display = 'block';
    document.getElementById('leaveRoomBtn').style.display = 'block';
    
    updatePlayersList(data.players);
    showNotification(`Joined room ${data.roomCode} successfully!`, 'success');
    localStorage.setItem('lastRoom', data.roomCode);
}

function handleGameStarted(data) {
    multiplayerGameState = {
        questions: data.questions,
        currentQuestion: 0,
        score: 0
    };
    
    document.getElementById('waitingArea').style.display = 'none';
    document.getElementById('multiplayerQuestionArea').style.display = 'block';
    document.getElementById('multiplayerResults').style.display = 'none';
    
    showNotification('Game started!', 'success');
    showMultiplayerQuestion(data.questions[0], 0);
}

function handleQuestionUpdate(data) {
    multiplayerGameState.currentQuestion = data.questionIndex;
    showMultiplayerQuestion(data.question, data.questionIndex);
}

function handleGameEnded(data) {
    showMultiplayerScoreboard(data.results);
}

// Leaderboard Functions
function loadLeaderboard() {
    // Sort scores by score (descending)
    scoresDB.sort((a, b) => b.score - a.score);
    
    const leaderboardEl = document.getElementById('leaderboardList');
    
    if (scoresDB.length === 0) {
        leaderboardEl.innerHTML = '<p>No scores yet. Be the first to play!</p>';
        return;
    }
    
    leaderboardEl.innerHTML = scoresDB.slice(0, 10).map((score, index) => 
        `<div class="leaderboard-item ${score.username === currentUser?.username ? 'current-user' : ''}">
            <span><span class="leaderboard-rank">${index + 1}.</span> ${score.username}</span>
            <span>${score.score} (${score.accuracy}%)</span>
        </div>`
    ).join('');
}

// Notification System
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 500);
    }, 3000);
}

// Initialize the game
document.addEventListener('DOMContentLoaded', function() {
    // Add event listeners for tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            showTab(tabName);
            
            // Initialize WebSocket when multiplayer tab is opened
            if (tabName === 'multiplayer' && !socket) {
                initializeWebSocket();
            }
        });
    });

    // Check if there's a logged in user
    const lastUser = localStorage.getItem('quantifiersGameLastUser');
    if (lastUser && usersDB[lastUser]) {
        currentUser = usersDB[lastUser];
        document.getElementById('currentUser').textContent = currentUser.username;
        document.getElementById('bestScore').textContent = currentUser.bestScore;
        showTab('solo');
    } else {
        showTab('auth');
    }
});
// Fun√ß√£o para mostrar o placar final (single player)
function showFinalScoreboard(score, totalQuestions, timeSpent) {
    const accuracy = Math.round((score / totalQuestions) * 100);
    const timeFormatted = formatTime(timeSpent);
    
    const scoreboardHTML = `
        <div class="scoreboard" id="finalScoreboard">
            <div class="scoreboard-content">
                <h2 class="scoreboard-title">Game Over!</h2>
                <div class="scoreboard-results">
                    <div class="scoreboard-item">
                        <span class="scoreboard-label">Correct Answers:</span>
                        <span class="scoreboard-value">${score}/${totalQuestions}</span>
                    </div>
                    <div class="scoreboard-item">
                        <span class="scoreboard-label">Accuracy:</span>
                        <span class="scoreboard-value">${accuracy}%</span>
                    </div>
                    <div class="scoreboard-item">
                        <span class="scoreboard-label">Time:</span>
                        <span class="scoreboard-value">${timeFormatted}</span>
                    </div>
                    <div class="scoreboard-item">
                        <span class="scoreboard-label">Score:</span>
                        <span class="scoreboard-value">${score * 10} points</span>
                    </div>
                </div>
                <div class="scoreboard-buttons">
                    <button class="btn" onclick="closeScoreboardAndRestart()">Play Again</button>
                    <button class="btn btn-secondary" onclick="closeScoreboardAndShowLeaderboard()">Leaderboard</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', scoreboardHTML);
}

// Fun√ß√£o para mostrar placar final multiplayer
function showMultiplayerScoreboard(results) {
    // Ordena os resultados por pontua√ß√£o (maior primeiro)
    results.sort((a, b) => b.score - a.score);
    
    const playerItems = results.map((player, index) => `
        <div class="scoreboard-item ${player.username === currentUser.username ? 'current-user' : ''}">
            <span class="scoreboard-label">${index + 1}. ${player.username}</span>
            <span class="scoreboard-value">${player.score}/10 (${player.score * 10} pts)</span>
        </div>
    `).join('');
    
    const userPosition = results.findIndex(p => p.username === currentUser.username) + 1;
    const userScore = results.find(p => p.username === currentUser.username)?.score || 0;
    
    const scoreboardHTML = `
        <div class="scoreboard" id="finalScoreboard">
            <div class="scoreboard-content">
                <h2 class="scoreboard-title">Game Results</h2>
                <div class="scoreboard-results">
                    ${playerItems}
                </div>
                <p style="margin: 20px 0; font-size: 1.1rem;">
                    You finished in position <strong>${userPosition}</strong> with <strong>${userScore}/10</strong> correct answers!
                </p>
                <div class="scoreboard-buttons">
                    <button class="btn" onclick="closeScoreboardAndLeaveRoom()">Back to Lobby</button>
                    <button class="btn btn-secondary" onclick="closeScoreboardAndShowLeaderboard()">Leaderboard</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', scoreboardHTML);
}

// Fun√ß√µes auxiliares
function closeScoreboard() {
    const scoreboard = document.getElementById('finalScoreboard');
    if (scoreboard) {
        scoreboard.remove();
    }
}

function closeScoreboardAndRestart() {
    closeScoreboard();
    startSoloGame();
}

function closeScoreboardAndShowLeaderboard() {
    closeScoreboard();
    showTab('leaderboard');
}

function closeScoreboardAndLeaveRoom() {
    closeScoreboard();
    leaveRoom();
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}m ${secs}s`;
}

// Questions Database (same as in your server.js)
const questionsDB = [
{
                question: "I don't have _____ money left.",
                options: ["some", "any", "many", "much"],
                correct: 1,
                explanation: "Use 'any' in negative statements. 'Any' is used with both countable and uncountable nouns in negative sentences.",
                translation: "Eu n√£o tenho dinheiro restante."
            },
            {
                question: "How _____ students are in your class?",
                options: ["much", "many", "few", "little"],
                correct: 1,
                explanation: "Use 'many' with countable nouns in questions. Students are countable, so we use 'many'.",
                translation: "Quantos estudantes tem na sua turma?"
            },
            {
question: "there isn't _____ milk in the fridge.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "use 'any' in negative sentences with uncountable nouns like 'milk'.",
translation: "n√£o h√° leite na geladeira."
},

{
question: "she has _____ friends in london.",
options: ["much", "any", "a few", "a little"],
correct: 2,
explanation: "'a few' is used with countable nouns ('friends') to indicate a small quantity.",
translation: "ela tem alguns amigos em londres."
},

{
question: "do you have _____ time to help me?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in questions when offering or requesting something.",
translation: "voc√™ tem algum tempo para me ajudar?"
},

{
question: "there are too _____ people here.",
options: ["much", "many", "little", "any"],
correct: 1,
explanation: "'many' is used with countable nouns ('people').",
translation: "h√° muitas pessoas aqui."
},

{
question: "i need _____ water, please.",
options: ["any", "a few", "a little", "many"],
correct: 2,
explanation: "'a little' is used with uncountable nouns ('water') to indicate a small amount.",
translation: "eu preciso de um pouco de √°gua, por favor."
},

{
question: "he doesn't have _____ patience for this.",
options: ["some", "any", "many", "few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns ('patience').",
translation: "ele n√£o tem paci√™ncia para isso."
},

{
question: "we have _____ apples, but not many.",
options: ["some", "any", "much", "little"],
correct: 0,
explanation: "'some' indicates an unspecified quantity (countable nouns).",
translation: "temos algumas ma√ß√£s, mas n√£o muitas."
},

{
question: "is there _____ sugar left?",
options: ["some", "any", "many", "few"],
correct: 1,
explanation: "'any' is used in questions with uncountable nouns ('sugar').",
translation: "ainda tem a√ß√∫car?"
},

{
question: "there's _____ traffic today.",
options: ["many", "any", "a lot of", "few"],
correct: 2,
explanation: "'a lot of' works with both countable and uncountable nouns ('traffic').",
translation: "tem muito tr√¢nsito hoje."
},

{
question: "she drank _____ coffee before work.",
options: ["a few", "a little", "many", "any"],
correct: 1,
explanation: "'a little' is used with uncountable nouns ('coffee').",
translation: "ela bebeu um pouco de caf√© antes do trabalho."
},

{
question: "they didn't bring _____ food to the party.",
options: ["some", "any", "much", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns ('food').",
translation: "eles n√£o trouxeram comida para a festa."
},

{
question: "can i have _____ more tea?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in requests (even in questions).",
translation: "posso tomar mais um pouco de ch√°?"
},

{
question: "there are _____ books on the shelf.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' indicates an unspecified quantity (countable nouns).",
translation: "h√° alguns livros na prateleira."
},

{
question: "he has _____ money saved for his trip.",
options: ["a few", "a little", "many", "any"],
correct: 1,
explanation: "'a little' is used with uncountable nouns ('money').",
translation: "ele tem um pouco de dinheiro guardado para a viagem."
},

{
question: "are there _____ cookies left?",
options: ["some", "any", "much", "little"],
correct: 1,
explanation: "'any' is used in questions with plural countable nouns ('cookies').",
translation: "sobrou algum biscoito?"
},

{
question: "would you like _____ sugar in your coffee?",
options: ["some", "any", "many", "a few"],
correct: 0,
explanation: "'some' is used in offers and polite requests.",
translation: "voc√™ quer a√ß√∫car no seu caf√©?"
},

{
question: "there aren't _____ chairs available.",
options: ["some", "any", "much", "a little"],
correct: 1,
explanation: "'any' is used in negative sentences with plural countable nouns.",
translation: "n√£o h√° cadeiras dispon√≠veis."
},

{
question: "she bought _____ new shoes yesterday.",
options: ["any", "some", "much", "a little"],
correct: 1,
explanation: "'some' indicates an unspecified quantity (countable nouns).",
translation: "ela comprou alguns sapatos novos ontem."
},

{
question: "do you need _____ help with your homework?",
options: ["some", "any", "many", "few"],
correct: 1,
explanation: "'any' is used in questions (uncountable nouns like 'help').",
translation: "voc√™ precisa de ajuda com seu dever de casa?"
},

{
question: "there's _____ butter in the fridge.",
options: ["a few", "a little", "many", "any"],
correct: 1,
explanation: "'a little' is used with uncountable nouns (e.g., 'butter').",
translation: "tem um pouco de manteiga na geladeira."
},

{
question: "he doesn't have _____ brothers or sisters.",
options: ["some", "any", "much", "a little"],
correct: 1,
explanation: "'any' is used in negative sentences with plural countable nouns.",
translation: "ele n√£o tem irm√£os ou irm√£s."
},

{
question: "could you give me _____ paper, please?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in polite requests (uncountable nouns).",
translation: "voc√™ poderia me dar um pouco de papel, por favor?"
},

{
question: "there were _____ people at the concert.",
options: ["a little", "any", "a lot of", "few"],
correct: 2,
explanation: "'a lot of' emphasizes a large quantity (countable/uncountable).",
translation: "havia muitas pessoas no show."
},

{
question: "i have _____ questions about the lesson.",
options: ["a few", "a little", "much", "any"],
correct: 0,
explanation: "'a few' is used with plural countable nouns (e.g., 'questions').",
translation: "tenho algumas perguntas sobre a aula."
},

{
question: "we don't have _____ time to waste.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences (uncountable nouns like 'time').",
translation: "n√£o temos tempo a perder."
},

{
question: "she needs _____ more minutes to finish.",
options: ["some", "any", "much", "a little"],
correct: 0,
explanation: "'some' can modify plural countable nouns (e.g., 'minutes').",
translation: "ela precisa de mais alguns minutos para terminar."
},

{
question: "is there _____ cheese in the sandwich?",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in questions (uncountable nouns like 'cheese').",
translation: "tem queijo no sandu√≠che?"
},

{
question: "they ate _____ cookies after dinner.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' indicates an unspecified quantity (countable nouns).",
translation: "eles comeram alguns biscoitos ap√≥s o jantar."
},

{
question: "there isn't _____ noise outside today.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences (uncountable nouns like 'noise').",
translation: "n√£o h√° barulho l√° fora hoje."
},

{
question: "do you want _____ ice cream?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in offers (uncountable nouns like 'ice cream').",
translation: "voc√™ quer um pouco de sorvete?"
},

{
question: "we need _____ eggs to make the cake.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' is used with plural countable nouns (e.g., 'eggs') to indicate an unspecified quantity.",
translation: "precisamos de alguns ovos para fazer o bolo."
},

{
question: "there isn't _____ coffee left in the pot.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns (e.g., 'coffee').",
translation: "n√£o h√° caf√© restante na garrafa."
},

{
question: "would you like _____ milk with your cereal?",
options: ["any", "some", "many", "a few"],
correct: 1,
explanation: "'some' is used in offers (uncountable nouns like 'milk').",
translation: "voc√™ quer leite com seu cereal?"
},

{
question: "i have _____ important news to share.",
options: ["a few", "a little", "some", "any"],
correct: 2,
explanation: "'some' can be used with uncountable nouns (e.g., 'news') in positive statements.",
translation: "tenho algumas not√≠cias importantes para compartilhar."
},

{
question: "there are _____ beautiful flowers in the garden.",
options: ["any", "some", "much", "a little"],
correct: 1,
explanation: "'some' indicates an unspecified quantity of countable nouns (e.g., 'flowers').",
translation: "h√° algumas flores bonitas no jardim."
},

{
question: "do you have _____ plans for the weekend?",
options: ["some", "any", "many", "a little"],
correct: 1,
explanation: "'any' is used in questions with plural countable nouns (e.g., 'plans').",
translation: "voc√™ tem planos para o fim de semana?"
},

{
question: "she added _____ salt to the soup.",
options: ["a few", "a little", "any", "many"],
correct: 1,
explanation: "'a little' is used with uncountable nouns (e.g., 'salt') to indicate a small amount.",
translation: "ela adicionou um pouco de sal na sopa."
},

{
question: "we don't have _____ information about the case.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns (e.g., 'information').",
translation: "n√£o temos informa√ß√µes sobre o caso."
},

{
question: "could you lend me _____ money until tomorrow?",
options: ["some", "any", "much", "a few"],
correct: 0,
explanation: "'some' is used in requests (uncountable nouns like 'money').",
translation: "voc√™ poderia me emprestar algum dinheiro at√© amanh√£?"
},

{
question: "there were _____ students absent today.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' indicates an unspecified number of countable nouns (e.g., 'students').",
translation: "houve alguns alunos ausentes hoje."
},
{
question: "i'd like to buy _____ new clothes for summer.",
options: ["some", "any", "much", "few"],
correct: 0,
explanation: "'some' is used with plural countable nouns ('clothes') in positive statements.",
translation: "eu gostaria de comprar algumas roupas novas para o ver√£o."
},

{
question: "there isn't _____ juice in the glass.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns ('juice').",
translation: "n√£o h√° suco no copo."
},

{
question: "do we have _____ bread for breakfast?",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in questions with uncountable nouns ('bread').",
translation: "temos p√£o para o caf√© da manh√£?"
},

{
question: "she put _____ sugar in her tea.",
options: ["a few", "a little", "any", "many"],
correct: 1,
explanation: "'a little' is used with uncountable nouns ('sugar') for small quantities.",
translation: "ela colocou um pouco de a√ß√∫car no ch√°."
},

{
question: "we saw _____ deer in the forest yesterday.",
options: ["some", "any", "much", "a little"],
correct: 0,
explanation: "'some' is used with plural countable nouns ('deer') in positive statements.",
translation: "vimos alguns cervos na floresta ontem."
},

{
question: "there aren't _____ good restaurants in this area.",
options: ["some", "any", "much", "a little"],
correct: 1,
explanation: "'any' is used in negative sentences with plural countable nouns ('restaurants').",
translation: "n√£o h√° bons restaurantes nesta √°rea."
},

{
question: "could i have _____ more coffee, please?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in polite requests (uncountable nouns like 'coffee').",
translation: "eu poderia tomar mais um pouco de caf√©, por favor?"
},

{
question: "there's _____ sand in my shoes.",
options: ["a few", "a little", "any", "many"],
correct: 1,
explanation: "'a little' is used with uncountable nouns ('sand') for small amounts.",
translation: "tem um pouco de areia nos meus sapatos."
},

{
question: "do you know _____ good jokes?",
options: ["some", "any", "much", "a little"],
correct: 1,
explanation: "'any' is used in questions with plural countable nouns ('jokes').",
translation: "voc√™ conhece alguma piada boa?"
},

{
question: "i need to find _____ information about hotels.",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used with uncountable nouns ('information') in positive statements.",
translation: "preciso encontrar algumas informa√ß√µes sobre hot√©is."
},

{
question: "there wasn't _____ wind yesterday.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns ('wind').",
translation: "n√£o havia vento ontem."
},

{
question: "would you like _____ help with your bags?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in offers (uncountable nouns like 'help').",
translation: "voc√™ gostaria de ajuda com suas malas?"
},

{
question: "we have _____ oranges in the fridge.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' indicates an unspecified quantity of countable nouns ('oranges').",
translation: "temos algumas laranjas na geladeira."
},

{
question: "there isn't _____ furniture in this room.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns ('furniture').",
translation: "n√£o h√° m√≥veis neste quarto."
},

{
question: "can you give me _____ advice about this?",
options: ["some", "any", "many", "a few"],
correct: 0,
explanation: "'some' is used with uncountable nouns ('advice') in requests.",
translation: "voc√™ pode me dar algum conselho sobre isso?"
},

{
question: "i don't have _____ experience in this field.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns ('experience').",
translation: "n√£o tenho experi√™ncia neste campo."
},

{
question: "there are _____ children playing in the park.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' indicates an unspecified number of countable nouns ('children').",
translation: "h√° algumas crian√ßas brincando no parque."
},

{
question: "we didn't buy _____ vegetables at the market.",
options: ["some", "any", "much", "a little"],
correct: 1,
explanation: "'any' is used in negative sentences with plural countable nouns ('vegetables').",
translation: "n√£o compramos vegetais no mercado."
},

{
question: "could you bring me _____ water, please?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in polite requests (uncountable nouns like 'water').",
translation: "voc√™ poderia me trazer um pouco de √°gua, por favor?"
},

{
question: "there's _____ rice left in the pot.",
options: ["a few", "a little", "any", "many"],
correct: 1,
explanation: "'a little' is used with uncountable nouns ('rice') for small amounts.",
translation: "tem um pouco de arroz restante na panela."
},
{
question: "there were _____ people at the concert.",
options: ["a little", "any", "a lot of", "few"],
correct: 2,
explanation: "'a lot of' emphasizes a large quantity (countable/uncountable).",
translation: "havia muitas pessoas no show."
},

{
question: "i have _____ questions about the lesson.",
options: ["a few", "a little", "much", "any"],
correct: 0,
explanation: "'a few' is used with plural countable nouns (e.g., 'questions').",
translation: "tenho algumas perguntas sobre a aula."
},

{
question: "we don't have _____ time to waste.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences (uncountable nouns like 'time').",
translation: "n√£o temos tempo a perder."
},

{
question: "she needs _____ more minutes to finish.",
options: ["some", "any", "much", "a little"],
correct: 0,
explanation: "'some' can modify plural countable nouns (e.g., 'minutes').",
translation: "ela precisa de mais alguns minutos para terminar."
},

{
question: "is there _____ cheese in the sandwich?",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in questions (uncountable nouns like 'cheese').",
translation: "tem queijo no sandu√≠che?"
},

{
question: "they ate _____ cookies after dinner.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' indicates an unspecified quantity (countable nouns).",
translation: "eles comeram alguns biscoitos ap√≥s o jantar."
},

{
question: "there isn't _____ noise outside today.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences (uncountable nouns like 'noise').",
translation: "n√£o h√° barulho l√° fora hoje."
},

{
question: "do you want _____ ice cream?",
options: ["some", "any", "many", "few"],
correct: 0,
explanation: "'some' is used in offers (uncountable nouns like 'ice cream').",
translation: "voc√™ quer um pouco de sorvete?"
},

{
question: "we need _____ eggs to make the cake.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' is used with plural countable nouns (e.g., 'eggs') to indicate an unspecified quantity.",
translation: "precisamos de alguns ovos para fazer o bolo."
},

{
question: "there isn't _____ coffee left in the pot.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns (e.g., 'coffee').",
translation: "n√£o h√° caf√© restante na garrafa."
},

{
question: "would you like _____ milk with your cereal?",
options: ["any", "some", "many", "a few"],
correct: 1,
explanation: "'some' is used in offers (uncountable nouns like 'milk').",
translation: "voc√™ quer leite com seu cereal?"
},

{
question: "i have _____ important news to share.",
options: ["a few", "a little", "some", "any"],
correct: 2,
explanation: "'some' can be used with uncountable nouns (e.g., 'news') in positive statements.",
translation: "tenho algumas not√≠cias importantes para compartilhar."
},

{
question: "there are _____ beautiful flowers in the garden.",
options: ["any", "some", "much", "a little"],
correct: 1,
explanation: "'some' indicates an unspecified quantity of countable nouns (e.g., 'flowers').",
translation: "h√° algumas flores bonitas no jardim."
},

{
question: "do you have _____ plans for the weekend?",
options: ["some", "any", "many", "a little"],
correct: 1,
explanation: "'any' is used in questions with plural countable nouns (e.g., 'plans').",
translation: "voc√™ tem planos para o fim de semana?"
},

{
question: "she added _____ salt to the soup.",
options: ["a few", "a little", "any", "many"],
correct: 1,
explanation: "'a little' is used with uncountable nouns (e.g., 'salt') to indicate a small amount.",
translation: "ela adicionou um pouco de sal na sopa."
},

{
question: "we don't have _____ information about the case.",
options: ["some", "any", "many", "a few"],
correct: 1,
explanation: "'any' is used in negative sentences with uncountable nouns (e.g., 'information').",
translation: "n√£o temos informa√ß√µes sobre o caso."
},

{
question: "could you lend me _____ money until tomorrow?",
options: ["some", "any", "much", "a few"],
correct: 0,
explanation: "'some' is used in requests (uncountable nouns like 'money').",
translation: "voc√™ poderia me emprestar algum dinheiro at√© amanh√£?"
},

{
question: "there were _____ students absent today.",
options: ["a little", "any", "some", "much"],
correct: 2,
explanation: "'some' indicates an unspecified number of countable nouns (e.g., 'students').",
translation: "houve alguns alunos ausentes hoje."
},

];

</script>


</body>
</html>
